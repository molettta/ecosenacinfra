#!/usr/bin/env bash

########################
# SISTEMA DE BACKUP - MENU PRINCIPAL
########################

SCRIPT_DIR="/opt/backup/scripts"

# Cores
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m'

clear
echo -e "${CYAN}"
cat << "EOF"
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    SISTEMA DE BACKUP                              ‚ïë
‚ïë                  Infraestrutura Docker                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
echo -e "${NC}"

if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
    echo "Uso: backup [op√ß√£o]"
    echo ""
    echo "Op√ß√µes:"
    echo "  (sem op√ß√£o)    Abre o menu interativo"
    echo "  fazer          Faz backup agora"
    echo "  listar         Lista backups dispon√≠veis"
    echo "  restaurar      Restaura um backup"
    echo "  agendar        Configura backup autom√°tico"
    echo "  sync           Configura sincroniza√ß√£o remota"
    echo "  ajuda          Mostra esta mensagem"
    echo ""
    echo "Exemplos:"
    echo "  backup fazer"
    echo "  backup listar"
    echo "  backup restaurar /opt/backup/dados/infra-backup-*.tar.gz"
    exit 0
fi

# Atalhos diretos
case "$1" in
    fazer|run|exec)
        "${SCRIPT_DIR}/backup-infra.sh"
        exit $?
        ;;
    listar|list|ls)
        "${SCRIPT_DIR}/list-backups.sh" "$@"
        exit $?
        ;;
    restaurar|restore)
        shift
        "${SCRIPT_DIR}/restore-infra.sh" "$@"
        exit $?
        ;;
    agendar|schedule|cron)
        "${SCRIPT_DIR}/setup-backup-cron.sh"
        exit $?
        ;;
    sync|remoto)
        "${SCRIPT_DIR}/setup-backup-sync.sh"
        exit $?
        ;;
esac

# Menu interativo
echo ""
echo -e "${BLUE}Escolha uma op√ß√£o:${NC}"
echo ""
echo "  1) üì¶ Fazer backup agora"
echo "  2) üìã Listar backups dispon√≠veis"
echo "  3) ‚ôªÔ∏è  Restaurar um backup"
echo "  4) ‚è∞ Agendar backups autom√°ticos"
echo "  5) üåê Configurar sincroniza√ß√£o remota"
echo ""
echo "  6) üìñ Ver documenta√ß√£o"
echo "  7) üö™ Sair"
echo ""
read -p "Op√ß√£o [1-7]: " OPCAO

case ${OPCAO} in
    1)
        echo ""
        "${SCRIPT_DIR}/backup-infra.sh"
        ;;
    2)
        echo ""
        "${SCRIPT_DIR}/list-backups.sh"
        ;;
    3)
        echo ""
        "${SCRIPT_DIR}/list-backups.sh"
        ;;
    4)
        echo ""
        "${SCRIPT_DIR}/setup-backup-cron.sh"
        ;;
    5)
        echo ""
        "${SCRIPT_DIR}/setup-backup-sync.sh"
        ;;
    6)
        echo ""
        if [ -f "/opt/backup/README.md" ]; then
            less "/opt/backup/README.md" 2>/dev/null || cat "/opt/backup/README.md"
        else
            cat "/opt/backup/GUIA-RAPIDO.txt"
        fi
        ;;
    7)
        echo -e "${GREEN}At√© logo!${NC}"
        exit 0
        ;;
    *)
        echo -e "${YELLOW}Op√ß√£o inv√°lida!${NC}"
        exit 1
        ;;
esac

